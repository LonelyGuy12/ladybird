<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyScript Benchmark - Ladybird</title>
    
    <!-- PyScript -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .subtitle {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .benchmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .benchmark-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .benchmark-card h2 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .code-sample {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            overflow-x: auto;
            font-size: 0.9em;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.2);
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .comparison-table th {
            background: rgba(0, 0, 0, 0.2);
            color: #ffd700;
            font-weight: bold;
        }
        
        .faster {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .slower {
            color: #f44336;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffd700;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêç PyScript Performance Benchmark</h1>
        <p class="subtitle">Comparing Python and JavaScript execution in the browser</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Note:</strong> PyScript is loading from CDN. First run will be slower due to WASM initialization. 
            This benchmark compares PyScript (Python via WebAssembly) vs native JavaScript performance.
        </div>
        
        <div id="pyscript-status" class="loading">
            <div class="spinner"></div>
            <span style="margin-left: 10px;">Initializing PyScript...</span>
        </div>
        
        <div class="benchmark-grid">
            <div class="benchmark-card">
                <h2>Test 1: Fibonacci Calculation</h2>
                <p>Calculate the 30th Fibonacci number</p>
                <div class="code-sample">def fib(n):
    if n <= 1:
        return n
    return fib(n-1) + fib(n-2)

result = fib(30)</div>
                <button onclick="runFibonacciBenchmark()" id="fib-btn">Run Fibonacci Test</button>
                <div id="fib-result"></div>
            </div>
            
            <div class="benchmark-card">
                <h2>Test 2: List Processing</h2>
                <p>Create and process large lists</p>
                <div class="code-sample">numbers = list(range(100000))
squares = [x**2 for x in numbers]
total = sum(squares)</div>
                <button onclick="runListBenchmark()" id="list-btn">Run List Test</button>
                <div id="list-result"></div>
            </div>
            
            <div class="benchmark-card">
                <h2>Test 3: String Operations</h2>
                <p>String concatenation and manipulation</p>
                <div class="code-sample">text = ""
for i in range(10000):
    text += str(i)
reversed_text = text[::-1]</div>
                <button onclick="runStringBenchmark()" id="string-btn">Run String Test</button>
                <div id="string-result"></div>
            </div>
            
            <div class="benchmark-card">
                <h2>Test 4: Array Sorting</h2>
                <p>Sort large arrays</p>
                <div class="code-sample">import random
arr = [random.randint(0, 1000) 
       for _ in range(50000)]
sorted_arr = sorted(arr)</div>
                <button onclick="runSortBenchmark()" id="sort-btn">Run Sort Test</button>
                <div id="sort-result"></div>
            </div>
        </div>
        
        <div class="benchmark-card">
            <h2>üìä Performance Comparison Summary</h2>
            <table class="comparison-table" id="summary-table">
                <thead>
                    <tr>
                        <th>Test</th>
                        <th>JavaScript (ms)</th>
                        <th>PyScript (ms)</th>
                        <th>Ratio</th>
                        <th>Winner</th>
                    </tr>
                </thead>
                <tbody id="summary-body">
                    <tr>
                        <td colspan="5" style="text-align: center; opacity: 0.6;">Run tests to see results</td>
                    </tr>
                </tbody>
            </table>
            <button onclick="runAllBenchmarks()" id="run-all-btn" style="width: 100%;">üöÄ Run All Benchmarks</button>
        </div>
        
        <div style="text-align: center;">
            <a href="index.html" class="back-link">‚Üê Back to Test Suite</a>
        </div>
    </div>

    <!-- PyScript Code -->
    <script type="py" src="pyscript.toml" config='{"packages": ["numpy"]}'>
        import time
        from js import document, console, window
        
        # Signal that PyScript is ready
        def on_ready():
            status_div = document.getElementById('pyscript-status')
            status_div.innerHTML = '<strong style="color: #4CAF50;">‚úÖ PyScript Ready!</strong> You can now run benchmarks.'
            console.log("PyScript initialized successfully")
        
        on_ready()
        
        # Fibonacci
        def benchmark_fibonacci():
            def fib(n):
                if n <= 1:
                    return n
                return fib(n-1) + fib(n-2)
            
            start = time.time()
            result = fib(30)
            elapsed = (time.time() - start) * 1000
            return elapsed, result
        
        # List processing
        def benchmark_list():
            start = time.time()
            numbers = list(range(100000))
            squares = [x**2 for x in numbers]
            total = sum(squares)
            elapsed = (time.time() - start) * 1000
            return elapsed, total
        
        # String operations
        def benchmark_string():
            start = time.time()
            text = ""
            for i in range(10000):
                text += str(i)
            reversed_text = text[::-1]
            elapsed = (time.time() - start) * 1000
            return elapsed, len(text)
        
        # Array sorting
        def benchmark_sort():
            import random
            start = time.time()
            arr = [random.randint(0, 1000) for _ in range(50000)]
            sorted_arr = sorted(arr)
            elapsed = (time.time() - start) * 1000
            return elapsed, len(sorted_arr)
        
        # Expose functions to JavaScript
        window.py_benchmark_fibonacci = benchmark_fibonacci
        window.py_benchmark_list = benchmark_list
        window.py_benchmark_string = benchmark_string
        window.py_benchmark_sort = benchmark_sort
    </script>

    <script>
        const results = {};
        
        // JavaScript implementations for comparison
        function jsFibonacci(n) {
            if (n <= 1) return n;
            return jsFibonacci(n - 1) + jsFibonacci(n - 2);
        }
        
        function jsListProcessing() {
            const numbers = Array.from({length: 100000}, (_, i) => i);
            const squares = numbers.map(x => x ** 2);
            return squares.reduce((a, b) => a + b, 0);
        }
        
        function jsStringOperations() {
            let text = "";
            for (let i = 0; i < 10000; i++) {
                text += i.toString();
            }
            return text.split('').reverse().join('').length;
        }
        
        function jsSorting() {
            const arr = Array.from({length: 50000}, () => Math.floor(Math.random() * 1000));
            return arr.sort((a, b) => a - b).length;
        }
        
        async function runFibonacciBenchmark() {
            const btn = document.getElementById('fib-btn');
            const resultDiv = document.getElementById('fib-result');
            btn.disabled = true;
            
            resultDiv.innerHTML = '<div style="opacity: 0.7;">Running JavaScript version...</div>';
            await new Promise(r => setTimeout(r, 100));
            
            // JavaScript
            const jsStart = performance.now();
            const jsResult = jsFibonacci(30);
            const jsTime = performance.now() - jsStart;
            
            resultDiv.innerHTML += '<div style="opacity: 0.7;">Running PyScript version...</div>';
            await new Promise(r => setTimeout(r, 100));
            
            // PyScript
            try {
                const [pyTime, pyResult] = window.py_benchmark_fibonacci();
                
                const winner = jsTime < pyTime ? 'JavaScript' : 'PyScript';
                const ratio = (pyTime / jsTime).toFixed(2);
                
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <strong>Results:</strong><br>
                    JavaScript: ${jsTime.toFixed(2)}ms (result: ${jsResult})<br>
                    PyScript: ${pyTime.toFixed(2)}ms (result: ${pyResult})<br>
                    <strong class="${jsTime < pyTime ? 'faster' : 'slower'}">
                        ${winner} is ${ratio}x ${winner === 'JavaScript' ? 'faster' : 'slower'}
                    </strong>
                `;
                
                results.fibonacci = {js: jsTime, py: pyTime, ratio, winner};
                updateSummary();
            } catch (e) {
                resultDiv.className = 'warning';
                resultDiv.innerHTML = `Error: ${e.message}`;
            }
            
            btn.disabled = false;
        }
        
        async function runListBenchmark() {
            const btn = document.getElementById('list-btn');
            const resultDiv = document.getElementById('list-result');
            btn.disabled = true;
            
            resultDiv.innerHTML = '<div style="opacity: 0.7;">Running benchmarks...</div>';
            await new Promise(r => setTimeout(r, 100));
            
            const jsStart = performance.now();
            const jsResult = jsListProcessing();
            const jsTime = performance.now() - jsStart;
            
            try {
                const [pyTime, pyResult] = window.py_benchmark_list();
                
                const winner = jsTime < pyTime ? 'JavaScript' : 'PyScript';
                const ratio = (pyTime / jsTime).toFixed(2);
                
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <strong>Results:</strong><br>
                    JavaScript: ${jsTime.toFixed(2)}ms<br>
                    PyScript: ${pyTime.toFixed(2)}ms<br>
                    <strong class="${jsTime < pyTime ? 'faster' : 'slower'}">
                        ${winner} is ${ratio}x ${winner === 'JavaScript' ? 'faster' : 'slower'}
                    </strong>
                `;
                
                results.list = {js: jsTime, py: pyTime, ratio, winner};
                updateSummary();
            } catch (e) {
                resultDiv.className = 'warning';
                resultDiv.innerHTML = `Error: ${e.message}`;
            }
            
            btn.disabled = false;
        }
        
        async function runStringBenchmark() {
            const btn = document.getElementById('string-btn');
            const resultDiv = document.getElementById('string-result');
            btn.disabled = true;
            
            resultDiv.innerHTML = '<div style="opacity: 0.7;">Running benchmarks...</div>';
            await new Promise(r => setTimeout(r, 100));
            
            const jsStart = performance.now();
            const jsResult = jsStringOperations();
            const jsTime = performance.now() - jsStart;
            
            try {
                const [pyTime, pyResult] = window.py_benchmark_string();
                
                const winner = jsTime < pyTime ? 'JavaScript' : 'PyScript';
                const ratio = (pyTime / jsTime).toFixed(2);
                
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <strong>Results:</strong><br>
                    JavaScript: ${jsTime.toFixed(2)}ms<br>
                    PyScript: ${pyTime.toFixed(2)}ms<br>
                    <strong class="${jsTime < pyTime ? 'faster' : 'slower'}">
                        ${winner} is ${ratio}x ${winner === 'JavaScript' ? 'faster' : 'slower'}
                    </strong>
                `;
                
                results.string = {js: jsTime, py: pyTime, ratio, winner};
                updateSummary();
            } catch (e) {
                resultDiv.className = 'warning';
                resultDiv.innerHTML = `Error: ${e.message}`;
            }
            
            btn.disabled = false;
        }
        
        async function runSortBenchmark() {
            const btn = document.getElementById('sort-btn');
            const resultDiv = document.getElementById('sort-result');
            btn.disabled = true;
            
            resultDiv.innerHTML = '<div style="opacity: 0.7;">Running benchmarks...</div>';
            await new Promise(r => setTimeout(r, 100));
            
            const jsStart = performance.now();
            const jsResult = jsSorting();
            const jsTime = performance.now() - jsStart;
            
            try {
                const [pyTime, pyResult] = window.py_benchmark_sort();
                
                const winner = jsTime < pyTime ? 'JavaScript' : 'PyScript';
                const ratio = (pyTime / jsTime).toFixed(2);
                
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <strong>Results:</strong><br>
                    JavaScript: ${jsTime.toFixed(2)}ms<br>
                    PyScript: ${pyTime.toFixed(2)}ms<br>
                    <strong class="${jsTime < pyTime ? 'faster' : 'slower'}">
                        ${winner} is ${ratio}x ${winner === 'JavaScript' ? 'faster' : 'slower'}
                    </strong>
                `;
                
                results.sort = {js: jsTime, py: pyTime, ratio, winner};
                updateSummary();
            } catch (e) {
                resultDiv.className = 'warning';
                resultDiv.innerHTML = `Error: ${e.message}`;
            }
            
            btn.disabled = false;
        }
        
        function updateSummary() {
            const tbody = document.getElementById('summary-body');
            const tests = ['fibonacci', 'list', 'string', 'sort'];
            const testNames = {
                fibonacci: 'Fibonacci (n=30)',
                list: 'List Processing (100k)',
                string: 'String Concat (10k)',
                sort: 'Array Sort (50k)'
            };
            
            let html = '';
            for (const test of tests) {
                if (results[test]) {
                    const r = results[test];
                    html += `
                        <tr>
                            <td>${testNames[test]}</td>
                            <td class="${r.winner === 'JavaScript' ? 'faster' : ''}">${r.js.toFixed(2)}</td>
                            <td class="${r.winner === 'PyScript' ? 'faster' : ''}">${r.py.toFixed(2)}</td>
                            <td>${r.ratio}x</td>
                            <td class="faster">${r.winner}</td>
                        </tr>
                    `;
                }
            }
            
            if (html) {
                tbody.innerHTML = html;
            }
        }
        
        async function runAllBenchmarks() {
            const btn = document.getElementById('run-all-btn');
            btn.disabled = true;
            btn.textContent = 'Running all benchmarks...';
            
            await runFibonacciBenchmark();
            await new Promise(r => setTimeout(r, 500));
            await runListBenchmark();
            await new Promise(r => setTimeout(r, 500));
            await runStringBenchmark();
            await new Promise(r => setTimeout(r, 500));
            await runSortBenchmark();
            
            btn.disabled = false;
            btn.textContent = '‚úÖ All Benchmarks Complete!';
        }
    </script>
</body>
</html>
